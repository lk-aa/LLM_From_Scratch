<div align="center">

![logo](./images/logo.png)

</div>



* è¯¥é¡¹ç›®æ„å»ºäº†ä¸€ä¸ªå¤§æ¨¡å‹æç®€ç»“æ„ï¼Œæ•°æ®é›†æ¸…æ´—å’Œé¢„å¤„ç†ã€ç›‘ç£é¢„è®­ç»ƒ(Pretrain)ã€æœ‰ç›‘ç£æŒ‡ä»¤å¾®è°ƒ(SFT)ã€ä½ç§©è‡ªé€‚åº”(LoRA)
  å¾®è°ƒï¼Œæ— å¥–åŠ±å¼ºåŒ–å­¦ä¹ ç›´æ¥åå¥½å¯¹é½(DPO)çš„å…¨é˜¶æ®µä»£ç ï¼Œä¹ŸåŒ…å«æ‹“å±•å…±äº«æ··åˆä¸“å®¶(MoE)çš„ç¨€ç–æ¨¡å‹ï¼›
* è¿™ä¸ä»…æ˜¯ä¸€ä¸ªå¼€æºæ¨¡å‹Llamaçš„ç®€æ´å®ç°ï¼Œä¹Ÿæ˜¯å…¥é—¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ•™ç¨‹ã€‚
* å‚è€ƒé¡¹ç›®: [MiniMind](https://github.com/jingyaogong/minimind)ã€‚

___

# ğŸ“Œ Introduction

å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é¢†åŸŸï¼Œå¦‚ GPTã€LLaMAã€GLM ç­‰ï¼Œè™½ç„¶å®ƒä»¬æ•ˆæœæƒŠè‰³ï¼Œ
ä½†åŠ¨è¾„10 Bilionåºå¤§çš„æ¨¡å‹å‚æ•°ä¸ªäººè®¾å¤‡æ˜¾å­˜è¿œä¸å¤Ÿè®­ç»ƒï¼Œç”šè‡³æ¨ç†å›°éš¾ã€‚
å‡ ä¹æ‰€æœ‰äººéƒ½ä¸ä¼šåªæ»¡è¶³äºç”¨Loraç­‰æ–¹æ¡ˆfine-tuingå¤§æ¨¡å‹å­¦ä¼šä¸€äº›æ–°çš„æŒ‡ä»¤ï¼Œ
è¿™çº¦ç­‰äºåœ¨æ•™ç‰›é¡¿ç©21ä¸–çºªçš„æ™ºèƒ½æ‰‹æœºï¼Œç„¶è€Œï¼Œè¿™è¿œè¿œè„±ç¦»äº†å­¦ä¹ ç‰©ç†æœ¬èº«çš„å¥¥å¦™ã€‚
æ­¤å¤–ï¼Œå–è¯¾ä»˜è´¹è®¢é˜…çš„è¥é”€å·æ¼æ´ç™¾å‡ºçš„ä¸€çŸ¥åŠè§£è®²è§£AIçš„æ•™ç¨‹éåœ°ï¼Œ
è®©ç†è§£LLMçš„ä¼˜è´¨å†…å®¹é›ªä¸ŠåŠ éœœï¼Œä¸¥é‡é˜»ç¢äº†å­¦ä¹ è€…ã€‚

å› æ­¤ï¼Œæœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯æŠŠä¸Šæ‰‹LLMçš„é—¨æ§›æ— é™é™ä½ï¼Œ
ç›´æ¥ä»0å¼€å§‹è®­ç»ƒä¸€ä¸ªæå…¶è½»é‡çš„è¯­è¨€æ¨¡å‹ã€‚


# ğŸ“Œ Environment

ä»…æ˜¯æˆ‘ä¸ªäººçš„è½¯ç¡¬ä»¶ç¯å¢ƒé…ç½®ï¼Œè‡ªè¡Œé…Œæƒ…æ›´æ”¹ï¼š

```bash
CPU: Intel(R) Core(TM) i9-10980XE CPU @ 3.00GHz
å†…å­˜ï¼š16 GB
æ˜¾å¡ï¼šNVIDIA GeForce RTX 3050(4GB)
ç¯å¢ƒï¼špython 3.10 + Torch 2.1.2 + DDPå•æœºå¤šå¡è®­ç»ƒ
```

* Ubuntu == 20.04
* Python == 3.10
* Pytorch == 2.1.2
* CUDA == 11.8
* [requirements.txt](./requirements.txt)

# ğŸ“Œ Quick Start Test


# ğŸ“Œ Data sources



# ğŸ“Œ Model

MiniMind-Denseï¼ˆå’Œ[Llama3.1](https://ai.meta.com/blog/meta-llama-3-1/)ä¸€æ ·ï¼‰ä½¿ç”¨äº†Transformerçš„Decoder-Onlyç»“æ„ï¼Œè·ŸGPT-3çš„åŒºåˆ«åœ¨äºï¼š

* é‡‡ç”¨äº†GPT-3çš„é¢„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¯ä¸ªTransformerå­å±‚çš„è¾“å…¥ä¸Šè¿›è¡Œå½’ä¸€åŒ–ï¼Œè€Œä¸æ˜¯åœ¨è¾“å‡ºä¸Šã€‚å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯RMSNormå½’ä¸€åŒ–å‡½æ•°ã€‚
* ç”¨SwiGLUæ¿€æ´»å‡½æ•°æ›¿ä»£äº†ReLUï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚
* åƒGPT-Neoä¸€æ ·ï¼Œå»æ‰äº†ç»å¯¹ä½ç½®åµŒå…¥ï¼Œæ”¹ç”¨äº†æ—‹è½¬ä½ç½®åµŒå…¥ï¼ˆRoPEï¼‰ï¼Œè¿™æ ·åœ¨å¤„ç†è¶…å‡ºè®­ç»ƒé•¿åº¦çš„æ¨ç†æ—¶æ•ˆæœæ›´å¥½ã€‚

---

MiniMind-MoEæ¨¡å‹ï¼Œå®ƒçš„ç»“æ„åŸºäºLlama3å’Œ[Deepseek-V2](https://arxiv.org/pdf/2405.04434)ä¸­çš„MixFFNæ··åˆä¸“å®¶æ¨¡å—ã€‚

* DeepSeek-V2åœ¨å‰é¦ˆç½‘ç»œï¼ˆFFNï¼‰æ–¹é¢ï¼Œé‡‡ç”¨äº†æ›´ç»†ç²’åº¦çš„ä¸“å®¶åˆ†å‰²å’Œå…±äº«çš„ä¸“å®¶éš”ç¦»æŠ€æœ¯ï¼Œä»¥æé«˜Expertsçš„æ•ˆæœã€‚

---

MiniMindçš„æ•´ä½“ç»“æ„ä¸€è‡´ï¼Œåªæ˜¯åœ¨RoPEè®¡ç®—ã€æ¨ç†å‡½æ•°å’ŒFFNå±‚çš„ä»£ç ä¸Šåšäº†ä¸€äº›å°è°ƒæ•´ã€‚
å…¶ç»“æ„å¦‚ä¸‹å›¾ï¼š

![](./images/LLM-structure.png)
![](./images/LLM-structure-moe.png)

ä¿®æ”¹æ¨¡å‹é…ç½®è§[./model/LMConfig.py](./model/LMConfig.py)ã€‚


# ğŸ“Œ Experiment



1. **é¢„è®­ç»ƒ(Text-to-Text)**:
    - LLMé¦–å…ˆè¦å­¦ä¹ çš„å¹¶éç›´æ¥ä¸äººäº¤æµï¼Œè€Œæ˜¯è®©è‚šå­ä¸­å……æ»¡çŸ¥è¯†çš„å¢¨æ°´ï¼Œè‡³äºå¢¨æ°´ç†è®ºä¸Šå–çš„è¶Šé¥±è¶Šå¥½ï¼Œäº§ç”Ÿå¤§é‡çš„å¯¹ä¸–ç•Œçš„è®¤çŸ¥ç§¯ç´¯ã€‚
    - é¢„è®­ç»ƒå°±æ˜¯è®©Modelå…ˆåŸ‹å¤´è‹¦å­¦å¤§é‡åŸºæœ¬çš„çŸ¥è¯†ï¼Œä¾‹å¦‚ä»ç»´åŸºç™¾ç§‘ã€æ–°é—»ã€å¸¸è¯†ã€ä¹¦ç±ç­‰ã€‚
    - å®ƒæ— ç›‘ç£çš„ä»å¤§é‡çš„æ–‡æœ¬æ•°æ®ä¸­å‹ç¼©çŸ¥è¯†åˆ°è‡ªå·±æ¨¡å‹çš„æƒé‡ï¼Œç›®çš„æ˜¯ï¼šå­¦ä¼šè¯è¯­æ¥é¾™ã€‚ä¾‹å¦‚æˆ‘ä»¬è¾“å…¥â€œç§¦å§‹çš‡æ˜¯â€å››ä¸ªå­—ï¼Œå®ƒåœ¨å¤§é‡å­¦ä¹ åèƒ½é¢„æµ‹å‡ºä¸‹ä¸€å¥è¯å¤§æ¦‚ç‡æ˜¯â€œä¸­å›½çš„ç¬¬ä¸€ä½çš‡å¸â€ã€‚
   > pretrainçš„å­¦ä¹ ç‡è®¾ç½®ä¸º1e-4åˆ°1e-5çš„åŠ¨æ€å­¦ä¹ ç‡ï¼Œé¢„è®­ç»ƒepochæ•°è®¾ä¸º5ã€‚
    ```bash
    torchrun --nproc_per_node 2 1-pretrain.py
    ```

---
